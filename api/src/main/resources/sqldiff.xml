<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqldiff PUBLIC "-//OpenMRS//DTD OpenMRS SQL Diff Config 1.0//EN" "http://resources.openmrs.org/doctype/sqldiff-1.0.dtd">

<sqldiff version="1.0">
	<help>
		USE:
			The diffs are ordered by data model version number.
			The script can be run in a top down fashion and is
			expected to not fail or overwrite old data
		
		EXPECT:
			- "use business-database-name;" was called prior to
			   calling this script
	</help>
<diff>
		<version>0.9</version>
		<author>Deepa Ganu</author>
		<date></date>
		<description>Maintains the mapping between different sections of the CCD structure and the concepts which belong to each structure</description>
		<sql>
		 DROP TABLE IF EXISTS `openmrs`.`export_ccd_section_concept_map`;
CREATE TABLE  `openmrs`.`export_ccd_section_concept_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `concept_id` int(11) NOT NULL,
  `category` varchar(45) NOT NULL,
  `ccd_section_entity` varchar(45) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ccd_section_entity` (`ccd_section_entity`),
  KEY `concept_id` (`concept_id`),
  CONSTRAINT `concept_id` FOREIGN KEY (`concept_id`) REFERENCES `concept` (`concept_id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;
		
		</sql>
	</diff>

<diff>
		<version>0.9</version>
		<author>Hui Xiao</author>
		<date></date>
		<description>Allow All PHR users to access exportccd module</description>
		<sql>
insert into phr_allowed_url (allowed_url, required_privilege, description, creator, date_created) values('/module/exportccd/*','PHR Authenticated','used by exportccd module',1,now());

		 DROP TABLE IF EXISTS `openmrs`.`imported_ccd`;
CREATE TABLE  `openmrs`.`imported_ccd` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `patient_id` int(11) NOT NULL,
  `ccd` longtext DEFAULT NULL,
  `date_imported` datetime DEFAULT NULL,
  `imported_by` int(11) DEFAULT NULL,  
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_ccd_patient_id` (`patient_id`),
  CONSTRAINT `cnstr_ccd_patient_id` FOREIGN KEY (`patient_id`) REFERENCES `patient` (`patient_id`),
  CONSTRAINT `user_who_imported_ccd` FOREIGN KEY (`imported_by`) REFERENCES `users` (`user_id`)  
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;

		</sql>
	</diff>
	
	
</sqldiff>
